FROM public.ecr.aws/r3a1l1p0/chainapsis/ubuntu:24.04-keplr-firefox-build

RUN mkdir app

COPY ./ /app

WORKDIR /app

ARG KEPLR_EXT_ETHEREUM_ENDPOINT
ARG KEPLR_EXT_ANALYTICS_API_AUTH_TOKEN
ARG KEPLR_EXT_ANALYTICS_API_URL
ARG KEPLR_EXT_COINGECKO_ENDPOINT
ARG KEPLR_EXT_COINGECKO_GETPRICE
ARG KEPLR_EXT_COINGECKO_COIN_DATA_BY_TOKEN_ADDRESS
ARG KEPLR_EXT_TRANSAK_API_KEY
ARG KEPLR_EXT_MOONPAY_API_KEY
ARG KEPLR_EXT_KADO_API_KEY
ARG KEPLR_EXT_CHAIN_REGISTRY_URL
ARG KEPLR_EXT_GOOGLE_MEASUREMENT_ID
ARG KEPLR_EXT_GOOGLE_API_KEY_FOR_MEASUREMENT
ARG KEPLR_EXT_TOKEN_FACTORY_BASE_URL
ARG KEPLR_EXT_TOKEN_FACTORY_URI
ARG KEPLR_EXT_TX_HISTORY_BASE_URL
ARG KEPLR_EXT_CONFIG_SERVER
ARG WC_PROJECT_ID
ARG SKIP_API_KEY

ENV KEPLR_EXT_ETHEREUM_ENDPOINT $KEPLR_EXT_ETHEREUM_ENDPOINT
ENV KEPLR_EXT_ANALYTICS_API_AUTH_TOKEN $KEPLR_EXT_ANALYTICS_API_AUTH_TOKEN
ENV KEPLR_EXT_ANALYTICS_API_URL $KEPLR_EXT_ANALYTICS_API_URL
ENV KEPLR_EXT_COINGECKO_ENDPOINT $KEPLR_EXT_COINGECKO_ENDPOINT
ENV KEPLR_EXT_COINGECKO_GETPRICE $KEPLR_EXT_COINGECKO_GETPRICE
ENV KEPLR_EXT_COINGECKO_COIN_DATA_BY_TOKEN_ADDRESS $KEPLR_EXT_COINGECKO_COIN_DATA_BY_TOKEN_ADDRESS
ENV KEPLR_EXT_TRANSAK_API_KEY $KEPLR_EXT_TRANSAK_API_KEY
ENV KEPLR_EXT_MOONPAY_API_KEY $KEPLR_EXT_MOONPAY_API_KEY
ENV KEPLR_EXT_KADO_API_KEY $KEPLR_EXT_KADO_API_KEY
ENV KEPLR_EXT_CHAIN_REGISTRY_URL $KEPLR_EXT_CHAIN_REGISTRY_URL
ENV KEPLR_EXT_GOOGLE_MEASUREMENT_ID $KEPLR_EXT_GOOGLE_MEASUREMENT_ID
ENV KEPLR_EXT_GOOGLE_API_KEY_FOR_MEASUREMENT $KEPLR_EXT_GOOGLE_API_KEY_FOR_MEASUREMENT
ENV KEPLR_EXT_TOKEN_FACTORY_BASE_URL $KEPLR_EXT_TOKEN_FACTORY_BASE_URL
ENV KEPLR_EXT_TOKEN_FACTORY_URI $KEPLR_EXT_TOKEN_FACTORY_URI
ENV KEPLR_EXT_TX_HISTORY_BASE_URL $KEPLR_EXT_TX_HISTORY_BASE_URL
ENV KEPLR_EXT_CONFIG_SERVER $KEPLR_EXT_CONFIG_SERVER
ENV WC_PROJECT_ID $WC_PROJECT_ID
ENV SKIP_API_KEY $SKIP_API_KEY

RUN yarn install --immutable

RUN yarn build

VOLUME /data

WORKDIR /data

CMD mkdir -p ./build && cd ./build && find . -type f -delete && cp -r /app/apps/extension/build /data
